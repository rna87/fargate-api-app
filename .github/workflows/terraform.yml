name: "Terraform"

on:
  push:
    branches:
      - main
  pull_request:


jobs:
  terraform:
    name: "Terraform"
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./infra
    steps:
      - name: Checkout
        uses: actions/checkout@v3


      - name: Create tar gz file
        run: tar --exclude *.terraform* -zcvf build.tar.gz tf tf_modules
      
      - name: Terraform Cloud
        uses: addresscloud/terraform-cloud-action@v1.0.0
        with:
          tfToken: ${{ secrets.TF_API_TOKEN }}
          tfOrg: 'RNA'
          tfWorkspace: 'production'
          filePath: './build.tar.gz'
          identifier: ${{ github.sha }}